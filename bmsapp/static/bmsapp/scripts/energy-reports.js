// Generated by CoffeeScript 1.12.7
(function() {
  var _bldg_reports, _org_reports, _org_to_bldgs, update_bldg_list, update_report_list;

  _org_to_bldgs = {};

  _bldg_reports = {};

  _org_reports = {};

  update_bldg_list = function() {
    var add_bldg, bldg, i, len, org, ref;
    org = $("#select_org").val();
    $("#select_bldg").empty();
    add_bldg = function(bldg) {
      var optn;
      optn = new Option(bldg[0], bldg[1]);
      return $("#select_bldg").append(optn);
    };
    if (_org_to_bldgs[org] != null) {
      ref = _org_to_bldgs[org];
      for (i = 0, len = ref.length; i < len; i++) {
        bldg = ref[i];
        add_bldg(bldg);
      }
      return $("#select_bldg").val($("#select_bldg option:first").val());
    }
  };

  update_report_list = function() {
    var add_report, bldg, i, j, len, len1, org, ref, ref1, rpt;
    org = $("#select_org").val();
    bldg = $("#select_bldg").val();
    $("#report-tab-list").empty();
    add_report = function(rpt) {
      var html;
      html = "<li class=\"nav-item\">\n  <a class=\"nav-link\" data-toggle=\"tab\" href=\"#" + rpt.file_name + "\" role=\"tab\">" + rpt.title + "</a>\n</li>";
      return $("#report-tab-list").append(html);
    };
    if (_bldg_reports[bldg] != null) {
      ref = _bldg_reports[bldg];
      for (i = 0, len = ref.length; i < len; i++) {
        rpt = ref[i];
        add_report(rpt);
      }
    }
    if (_org_reports[org] != null) {
      ref1 = _org_reports[org];
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        rpt = ref1[j];
        add_report(rpt);
      }
    }
    return $("#report-tab-list a:first").addClass("active");
  };

  $(function() {
    var base_url;
    base_url = $("#energy-reports-url").text();
    if (base_url.length > 0) {
      $.getJSON(base_url + "org_to_bldgs.json").done(function(results) {
        _org_to_bldgs = results;
        update_bldg_list();
        return update_report_list();
      }).fail(function(jqxhr, textStatus, error) {
        var err;
        $("body").css("cursor", "default");
        err = textStatus + ", " + error;
        return alert("Error Occurred: " + err);
      });
      $.getJSON(base_url + "building.json").done(function(results) {
        _bldg_reports = results;
        return update_report_list();
      }).fail(function(jqxhr, textStatus, error) {
        var err;
        $("body").css("cursor", "default");
        err = textStatus + ", " + error;
        return alert("Error Occurred: " + err);
      });
      $.getJSON(base_url + "organization.json").done(function(results) {
        _org_reports = results;
        return update_report_list();
      }).fail(function(jqxhr, textStatus, error) {
        var err;
        $("body").css("cursor", "default");
        err = textStatus + ", " + error;
        return alert("Error Occurred: " + err);
      });
      $("#select_org").change(update_bldg_list);
      $("#select_org").change(update_report_list);
      return $("#select_bldg").change(update_report_list);
    }
  });

}).call(this);
