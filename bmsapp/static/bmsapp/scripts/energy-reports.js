// Generated by CoffeeScript 1.12.7
(function() {
  var _base_url, _bldg_reports, _org_reports, _org_to_bldgs, load_report, update_bldg_list, update_report_list;

  _base_url = "";

  _org_to_bldgs = {};

  _bldg_reports = {};

  _org_reports = {};

  update_bldg_list = function() {
    var add_bldg, bldg, i, len, org, ref;
    org = $("#select_org").val();
    $("#select_bldg").empty();
    add_bldg = function(bldg) {
      var optn;
      optn = new Option(bldg[0], bldg[1]);
      return $("#select_bldg").append(optn);
    };
    if (_org_to_bldgs[org] != null) {
      ref = _org_to_bldgs[org];
      for (i = 0, len = ref.length; i < len; i++) {
        bldg = ref[i];
        add_bldg(bldg);
      }
      $("#select_bldg").val($("#select_bldg option:first").val());
      return update_report_list();
    }
  };

  update_report_list = function() {
    var add_report, bldg, i, j, len, len1, org, ref, ref1, rpt, rpt_count;
    org = $("#select_org").val();
    bldg = $("#select_bldg").val();
    $("#report-tab-list").empty();
    add_report = function(rpt, rpt_type) {
      var html;
      html = "<li class=\"nav-item\">\n  <a class=\"nav-link\" data-toggle=\"tab\" href=\"#" + rpt_type + "-" + rpt.file_name + "\" role=\"tab\">" + rpt.title + "</a>\n</li>";
      return $("#report-tab-list").append(html);
    };
    rpt_count = 0;
    if (_bldg_reports[bldg] != null) {
      ref = _bldg_reports[bldg];
      for (i = 0, len = ref.length; i < len; i++) {
        rpt = ref[i];
        add_report(rpt, "B");
      }
      rpt_count += 1;
    }
    if (_org_reports[org] != null) {
      ref1 = _org_reports[org];
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        rpt = ref1[j];
        add_report(rpt, "O");
      }
      rpt_count += 1;
    }
    if (rpt_count > 0) {
      $("#report-tabs").show();
      $("#iframe-related").show();
      $("#report-tab-list a").click(load_report);
      return $("#report-tab-list a:first").addClass("active").click();
    } else {
      $("#report-tabs").hide();
      return $("#iframe-related").hide();
    }
  };

  load_report = function() {
    var report_file_name, report_info, report_url;
    report_info = $(this).attr("href").substring(1);
    report_file_name = report_info.substring(2);
    if (report_info.substring(0, 1) === "B") {
      report_url = _base_url + "building/" + ($("#select_bldg").val()) + "/" + report_file_name;
    } else {
      report_url = _base_url + "organization/" + ($("#select_org").val()) + "/" + report_file_name;
    }
    $("#report-content").attr("src", report_url);
    return $("#print-link").attr("href", report_url);
  };

  $(function() {
    _base_url = $("#energy-reports-url").text();
    if (_base_url.length > 0) {
      $.getJSON(_base_url + "org_to_bldgs.json").done(function(results) {
        _org_to_bldgs = results;
        update_bldg_list();
        return update_report_list();
      }).fail(function(jqxhr, textStatus, error) {
        var err;
        $("body").css("cursor", "default");
        err = textStatus + ", " + error;
        return alert("Error Occurred: " + err);
      });
      $.getJSON(_base_url + "building.json").done(function(results) {
        _bldg_reports = results;
        return update_report_list();
      }).fail(function(jqxhr, textStatus, error) {
        var err;
        $("body").css("cursor", "default");
        err = textStatus + ", " + error;
        return alert("Error Occurred: " + err);
      });
      $.getJSON(_base_url + "organization.json").done(function(results) {
        _org_reports = results;
        return update_report_list();
      }).fail(function(jqxhr, textStatus, error) {
        var err;
        $("body").css("cursor", "default");
        err = textStatus + ", " + error;
        return alert("Error Occurred: " + err);
      });
      $("#select_org").change(update_bldg_list);
      $("#select_org").change(update_report_list);
      return $("#select_bldg").change(update_report_list);
    } else {
      $("#bldg-selection").hide();
      $("#report-tabs").hide();
      return $("#iframe-related").hide();
    }
  });

}).call(this);
